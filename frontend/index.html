<!doctype html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="Öğrenci, öğretmen, çalışan ve yazılımcılar için modern görev takip ve zaman yönetimi sistemi" />
  <meta name="keywords"
    content="görev takibi, zaman yönetimi, pomodoro, planlama, üretkenlik, çalışma, öğrenci, öğretmen" />
  <link rel="icon" type="image/svg+xml" href="/logo.svg" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap"
    rel="stylesheet">

  <title>Görev Takip Sistemi</title>

  <!-- Theme Initialization Script -->
  <script>
    (function () {
      try {
        const root = document.documentElement;

        // 1. Get Storage Data safely
        const getUserPrefs = () => {
          try {
            const str = localStorage.getItem('user-preferences-storage');
            if (!str) return null;
            return JSON.parse(str).state.preferences;
          } catch (e) { return null; }
        };

        const getSiteSettings = () => {
          try {
            const str = localStorage.getItem('settings-storage');
            if (!str) return null;
            return JSON.parse(str).state.settings;
          } catch (e) { return null; }
        };

        const userPrefs = getUserPrefs();
        const siteSettings = getSiteSettings();

        // 2. Apply Dark/Light Mode
        let effectiveTheme = 'light';
        if (userPrefs) {
          if (userPrefs.theme === 'dark') {
            effectiveTheme = 'dark';
          } else if (userPrefs.theme === 'system') {
            effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          }
        }

        if (effectiveTheme === 'dark') root.classList.add('dark');
        else root.classList.remove('dark');

        // 3. Apply Primary Color (User preference > Site settings)
        let primaryColor = userPrefs?.customPrimaryColor || siteSettings?.primaryColor;

        if (primaryColor) {
          const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
              r: parseInt(result[1], 16),
              g: parseInt(result[2], 16),
              b: parseInt(result[3], 16)
            } : null;
          };
          const rgb = hexToRgb(primaryColor);
          if (rgb) {
            root.style.setProperty('--color-primary', `${rgb.r} ${rgb.g} ${rgb.b}`);
          }
        }
      } catch (e) {
        console.error('Theme init error:', e);
      }
    })();
  </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>